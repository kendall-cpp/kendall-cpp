## 后台组件编程

## 数据库
### 数据库的安装
```
ubuntu MySQL安装
sudo apt-get install mysql-server apt-get install mysql-client
sudo apt-get install libmysqlclient-dev
```
启动，停止，重启
```
sudo /etc/init.d/mysql start|stop|restart
```

客户端连接
```
mysql -h127.0.0.1 -uroot -p
```

查看初始密码

`sudo cat /etc/mysql/debian.cnf`
```
[client]
host     = localhost
user     = debian-sys-maint
password = bkj9qQqs2wovUaM1
socket   = /var/run/mysqld/mysqld.sock
[mysql_upgrade]
host     = localhost
user     = debian-sys-maint
password = bkj9qQqs2wovUaM1   #这就是密码
socket   = /var/run/mysqld/mysqld.sock
```

修改密码
```
1)、use mysql;         #连接到mysql数据库

2)、update mysql.user set authentication_string=password('123456') where user='root' and Host ='localhost';    #修改密码123456是密码

3)、update user set  plugin="mysql_native_password";     

4)、flush privileges;

5)、quit; 
```

查看mysql绑定的ip
```
sudo netstat -tap | grep mysql

tcp        0      0 localhost:mysql         0.0.0.0:*               LISTEN      853/mysqld  
```


### mysql 的外部连接

`MySQL`安装后默认是只允许本机访问`MySQL`

可以在`user`表中查看与确认。
```
mysql> select user,host from user;
+------------------+-----------+
| user             | host      |
+------------------+-----------+
| debian-sys-maint | localhost |
| mysql.session    | localhost |
| mysql.sys        | localhost |
| root             | localhost |
+------------------+-----------+
```

update修改其中某一条记录的`host`字段值为`'%'`，或者新增一条记录且`host`字段值为`'%'`。
```
update user set host = ‘%’ where user =’root’;

flush privileges;

quit

mysql> select user,host from user;
+------------------+-----------+
| user             | host      |
+------------------+-----------+
| root             | %         |
| debian-sys-maint | localhost |
| mysql.session    | localhost |
| mysql.sys        | localhost |
+------------------+-----------+
```
如果上面两种情况都不存在或不能解决，可以使用 `netstat` 命令查看 `mysql` 服务绑定的 `ip`， 如果绑定的是 `127.0.0.1`，则外部机器也不能访问 `mysql`。可以通过修改 `Mysql` 配置文件解决。 以 Ubuntu 系统为例，使用 `apt-get` 方式安装的 `Mysql`，配置文件默认位置通常是 `/etc/mysql/mysql.conf.d/mysqld.cnf`

```
sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf

注释掉以下一行即可:
#bind-address           = 127.0.0.1
```

Mysql重启 
`sudo /etc/init.d/mysql restart`

### mysql 的字符集

### libmysql 的开发环境
ubuntu 下安装libmysql           
`sudo apt-get install libmysqlclient-dev`

`sudo apt-get install libmysql++-dev`

拷贝lib：           
`sudo  cp /usr/lib/mysql/plugin /usr/lib/ -a`

编译执行            
`g++ mysql_test.cpp -Lmysql.h -lmysqlclient`

- 测试代码
```js
#include <stdio.h>
#include <iostream>
#include "/usr/include/mysql/mysql.h"
using namespace std;
int main() {
    MYSQL *conn_ptr;
    conn_ptr = mysql_init(NULL);  //初始化
    //"root":数据库管理员 "123":root密码 "test":数据库的名字
    conn_ptr = mysql_real_connect(conn_ptr, "localhost", "root", "123456","lingsheng-test", 0, NULL, 0);//连接数据库 1则success or failed
    if (conn_ptr) {
        cout << "connect success" << endl;
    } else {
        cout << "connect failed" << endl;
    }
    return 0;
}
```


